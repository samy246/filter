{"ast":null,"code":"import React, { useRef, useEffect, useState } from 'react';\nimport ReactDom from 'react-dom';\nimport cx from 'classnames';\nimport { disableBodyScroll, enableBodyScroll } from 'body-scroll-lock';\nimport useForwardedRef from '@bedrock-layout/use-forwarded-ref';\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nvar CloseIcon = function CloseIcon(_ref) {\n  var classes = _ref.classes,\n    classNames = _ref.classNames,\n    styles = _ref.styles,\n    id = _ref.id,\n    closeIcon = _ref.closeIcon,\n    onClick = _ref.onClick;\n  return React.createElement(\"button\", {\n    id: id,\n    className: cx(classes.closeButton, classNames == null ? void 0 : classNames.closeButton),\n    style: styles == null ? void 0 : styles.closeButton,\n    onClick: onClick,\n    \"data-testid\": \"close-button\"\n  }, closeIcon ? closeIcon : React.createElement(\"svg\", {\n    className: classNames == null ? void 0 : classNames.closeIcon,\n    style: styles == null ? void 0 : styles.closeIcon,\n    width: 28,\n    height: 28,\n    viewBox: \"0 0 36 36\",\n    \"data-testid\": \"close-icon\"\n  }, React.createElement(\"path\", {\n    d: \"M28.5 9.62L26.38 7.5 18 15.88 9.62 7.5 7.5 9.62 15.88 18 7.5 26.38l2.12 2.12L18 20.12l8.38 8.38 2.12-2.12L20.12 18z\"\n  })));\n};\nvar isBrowser = typeof window !== 'undefined';\n\n// https://github.com/alexandrzavalii/focus-trap-js/blob/master/src/index.js v1.1.0\nvar candidateSelectors = ['input', 'select', 'textarea', 'a[href]', 'button', '[tabindex]', 'audio[controls]', 'video[controls]', '[contenteditable]:not([contenteditable=\"false\"])'];\nfunction isHidden(node) {\n  // offsetParent being null will allow detecting cases where an element is invisible or inside an invisible element,\n  // as long as the element does not use position: fixed. For them, their visibility has to be checked directly as well.\n  return node.offsetParent === null || getComputedStyle(node).visibility === 'hidden';\n}\nfunction getCheckedRadio(nodes, form) {\n  for (var i = 0; i < nodes.length; i++) {\n    if (nodes[i].checked && nodes[i].form === form) {\n      return nodes[i];\n    }\n  }\n}\nfunction isNotRadioOrTabbableRadio(node) {\n  if (node.tagName !== 'INPUT' || node.type !== 'radio' || !node.name) {\n    return true;\n  }\n  var radioScope = node.form || node.ownerDocument;\n  var radioSet = radioScope.querySelectorAll('input[type=\"radio\"][name=\"' + node.name + '\"]');\n  var checked = getCheckedRadio(radioSet, node.form);\n  return checked === node || checked === undefined && radioSet[0] === node;\n}\nfunction getAllTabbingElements(parentElem) {\n  var currentActiveElement = document.activeElement;\n  var tabbableNodes = parentElem.querySelectorAll(candidateSelectors.join(','));\n  var onlyTabbable = [];\n  for (var i = 0; i < tabbableNodes.length; i++) {\n    var node = tabbableNodes[i];\n    if (currentActiveElement === node || !node.disabled && getTabindex(node) > -1 && !isHidden(node) && isNotRadioOrTabbableRadio(node)) {\n      onlyTabbable.push(node);\n    }\n  }\n  return onlyTabbable;\n}\nfunction tabTrappingKey(event, parentElem) {\n  // check if current event keyCode is tab\n  if (!event || event.key !== 'Tab') return;\n  if (!parentElem || !parentElem.contains) {\n    if (process && process.env.NODE_ENV === 'development') {\n      console.warn('focus-trap-js: parent element is not defined');\n    }\n    return false;\n  }\n  if (!parentElem.contains(event.target)) {\n    return false;\n  }\n  var allTabbingElements = getAllTabbingElements(parentElem);\n  var firstFocusableElement = allTabbingElements[0];\n  var lastFocusableElement = allTabbingElements[allTabbingElements.length - 1];\n  if (event.shiftKey && event.target === firstFocusableElement) {\n    lastFocusableElement.focus();\n    event.preventDefault();\n    return true;\n  } else if (!event.shiftKey && event.target === lastFocusableElement) {\n    firstFocusableElement.focus();\n    event.preventDefault();\n    return true;\n  }\n  return false;\n}\nfunction getTabindex(node) {\n  var tabindexAttr = parseInt(node.getAttribute('tabindex'), 10);\n  if (!isNaN(tabindexAttr)) return tabindexAttr; // Browsers do not return tabIndex correctly for contentEditable nodes;\n  // so if they don't have a tabindex attribute specifically set, assume it's 0.\n\n  if (isContentEditable(node)) return 0;\n  return node.tabIndex;\n}\nfunction isContentEditable(node) {\n  return node.getAttribute('contentEditable');\n}\nvar FocusTrap = function FocusTrap(_ref) {\n  var container = _ref.container,\n    initialFocusRef = _ref.initialFocusRef;\n  var refLastFocus = useRef();\n  /**\r\n   * Handle focus lock on the modal\r\n   */\n\n  useEffect(function () {\n    var handleKeyEvent = function handleKeyEvent(event) {\n      if (container == null ? void 0 : container.current) {\n        tabTrappingKey(event, container.current);\n      }\n    };\n    if (isBrowser) {\n      document.addEventListener('keydown', handleKeyEvent);\n    } // On mount we focus on the first focusable element in the modal if there is one\n\n    if (isBrowser && (container == null ? void 0 : container.current)) {\n      var savePreviousFocus = function savePreviousFocus() {\n        // First we save the last focused element\n        // only if it's a focusable element\n        if (candidateSelectors.findIndex(function (selector) {\n          var _document$activeEleme;\n          return (_document$activeEleme = document.activeElement) == null ? void 0 : _document$activeEleme.matches(selector);\n        }) !== -1) {\n          refLastFocus.current = document.activeElement;\n        }\n      };\n      if (initialFocusRef) {\n        savePreviousFocus(); // We need to schedule focusing on a next frame - this allows to focus on the modal root\n\n        requestAnimationFrame(function () {\n          var _initialFocusRef$curr;\n          (_initialFocusRef$curr = initialFocusRef.current) == null ? void 0 : _initialFocusRef$curr.focus();\n        });\n      } else {\n        var allTabbingElements = getAllTabbingElements(container.current);\n        if (allTabbingElements[0]) {\n          savePreviousFocus();\n          allTabbingElements[0].focus();\n        }\n      }\n    }\n    return function () {\n      if (isBrowser) {\n        var _refLastFocus$current;\n        document.removeEventListener('keydown', handleKeyEvent); // On unmount we restore the focus to the last focused element\n\n        (_refLastFocus$current = refLastFocus.current) == null ? void 0 : _refLastFocus$current.focus();\n      }\n    };\n  }, [container, initialFocusRef]);\n  return null;\n};\nvar modals = [];\n/**\r\n * Handle the order of the modals.\r\n * Inspired by the material-ui implementation.\r\n */\n\nvar modalManager = {\n  /**\r\n   * Register a new modal\r\n   */\n  add: function add(newModal) {\n    modals.push(newModal);\n  },\n  /**\r\n   * Remove a modal\r\n   */\n  remove: function remove(oldModal) {\n    modals = modals.filter(function (modal) {\n      return modal !== oldModal;\n    });\n  },\n  /**\r\n   * When multiple modals are rendered will return true if current modal is the last one\r\n   */\n  isTopModal: function isTopModal(modal) {\n    return !!modals.length && modals[modals.length - 1] === modal;\n  }\n};\nfunction useModalManager(ref, open) {\n  useEffect(function () {\n    if (open) {\n      modalManager.add(ref);\n    }\n    return function () {\n      modalManager.remove(ref);\n    };\n  }, [open, ref]);\n}\nvar useScrollLock = function useScrollLock(refModal, open, showPortal, blockScroll, reserveScrollBarGap) {\n  var oldRef = useRef(null);\n  useEffect(function () {\n    if (open && refModal.current && blockScroll) {\n      oldRef.current = refModal.current;\n      disableBodyScroll(refModal.current, {\n        reserveScrollBarGap: reserveScrollBarGap\n      });\n    }\n    return function () {\n      if (oldRef.current) {\n        enableBodyScroll(oldRef.current);\n        oldRef.current = null;\n      }\n    };\n  }, [open, showPortal, refModal, blockScroll, reserveScrollBarGap]);\n};\nvar classes = {\n  root: 'react-responsive-modal-root',\n  overlay: 'react-responsive-modal-overlay',\n  overlayAnimationIn: 'react-responsive-modal-overlay-in',\n  overlayAnimationOut: 'react-responsive-modal-overlay-out',\n  modalContainer: 'react-responsive-modal-container',\n  modalContainerCenter: 'react-responsive-modal-containerCenter',\n  modal: 'react-responsive-modal-modal',\n  modalAnimationIn: 'react-responsive-modal-modal-in',\n  modalAnimationOut: 'react-responsive-modal-modal-out',\n  closeButton: 'react-responsive-modal-closeButton'\n};\nvar Modal = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var _classNames$overlayAn, _classNames$overlayAn2, _classNames$modalAnim, _classNames$modalAnim2;\n  var open = _ref.open,\n    center = _ref.center,\n    _ref$blockScroll = _ref.blockScroll,\n    blockScroll = _ref$blockScroll === void 0 ? true : _ref$blockScroll,\n    _ref$closeOnEsc = _ref.closeOnEsc,\n    closeOnEsc = _ref$closeOnEsc === void 0 ? true : _ref$closeOnEsc,\n    _ref$closeOnOverlayCl = _ref.closeOnOverlayClick,\n    closeOnOverlayClick = _ref$closeOnOverlayCl === void 0 ? true : _ref$closeOnOverlayCl,\n    container = _ref.container,\n    _ref$showCloseIcon = _ref.showCloseIcon,\n    showCloseIcon = _ref$showCloseIcon === void 0 ? true : _ref$showCloseIcon,\n    closeIconId = _ref.closeIconId,\n    closeIcon = _ref.closeIcon,\n    _ref$focusTrapped = _ref.focusTrapped,\n    focusTrapped = _ref$focusTrapped === void 0 ? true : _ref$focusTrapped,\n    _ref$initialFocusRef = _ref.initialFocusRef,\n    initialFocusRef = _ref$initialFocusRef === void 0 ? undefined : _ref$initialFocusRef,\n    _ref$animationDuratio = _ref.animationDuration,\n    animationDuration = _ref$animationDuratio === void 0 ? 300 : _ref$animationDuratio,\n    classNames = _ref.classNames,\n    styles = _ref.styles,\n    _ref$role = _ref.role,\n    role = _ref$role === void 0 ? 'dialog' : _ref$role,\n    ariaDescribedby = _ref.ariaDescribedby,\n    ariaLabelledby = _ref.ariaLabelledby,\n    containerId = _ref.containerId,\n    modalId = _ref.modalId,\n    onClose = _ref.onClose,\n    onEscKeyDown = _ref.onEscKeyDown,\n    onOverlayClick = _ref.onOverlayClick,\n    onAnimationEnd = _ref.onAnimationEnd,\n    children = _ref.children,\n    reserveScrollBarGap = _ref.reserveScrollBarGap;\n  var refDialog = useForwardedRef(ref);\n  var refModal = useRef(null);\n  var refShouldClose = useRef(null);\n  var refContainer = useRef(null); // Lazily create the ref instance\n  // https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n\n  if (refContainer.current === null && isBrowser) {\n    refContainer.current = document.createElement('div');\n  } // The value should be false for srr, that way when the component is hydrated client side,\n  // it will match the server rendered content\n\n  var _useState = useState(false),\n    showPortal = _useState[0],\n    setShowPortal = _useState[1]; // Hook used to manage multiple modals opened at the same time\n\n  useModalManager(refModal, open); // Hook used to manage the scroll\n\n  useScrollLock(refModal, open, showPortal, blockScroll, reserveScrollBarGap);\n  var handleOpen = function handleOpen() {\n    if (refContainer.current && !container && !document.body.contains(refContainer.current)) {\n      document.body.appendChild(refContainer.current);\n    }\n    document.addEventListener('keydown', handleKeydown);\n  };\n  var handleClose = function handleClose() {\n    if (refContainer.current && !container && document.body.contains(refContainer.current)) {\n      document.body.removeChild(refContainer.current);\n    }\n    document.removeEventListener('keydown', handleKeydown);\n  };\n  var handleKeydown = function handleKeydown(event) {\n    // Only the last modal need to be escaped when pressing the esc key\n    if (event.keyCode !== 27 || !modalManager.isTopModal(refModal)) {\n      return;\n    }\n    onEscKeyDown == null ? void 0 : onEscKeyDown(event);\n    if (closeOnEsc) {\n      onClose();\n    }\n  };\n  useEffect(function () {\n    return function () {\n      if (showPortal) {\n        // When the modal is closed or removed directly, cleanup the listeners\n        handleClose();\n      }\n    };\n  }, [showPortal]);\n  useEffect(function () {\n    // If the open prop is changing, we need to open the modal\n    // This is also called on the first render if the open prop is true when the modal is created\n    if (open && !showPortal) {\n      setShowPortal(true);\n      handleOpen();\n    }\n  }, [open]);\n  var handleClickOverlay = function handleClickOverlay(event) {\n    if (refShouldClose.current === null) {\n      refShouldClose.current = true;\n    }\n    if (!refShouldClose.current) {\n      refShouldClose.current = null;\n      return;\n    }\n    onOverlayClick == null ? void 0 : onOverlayClick(event);\n    if (closeOnOverlayClick) {\n      onClose();\n    }\n    refShouldClose.current = null;\n  };\n  var handleModalEvent = function handleModalEvent() {\n    refShouldClose.current = false;\n  };\n  var handleAnimationEnd = function handleAnimationEnd() {\n    if (!open) {\n      setShowPortal(false);\n    }\n    onAnimationEnd == null ? void 0 : onAnimationEnd();\n  };\n  var containerModal = container || refContainer.current;\n  var overlayAnimation = open ? (_classNames$overlayAn = classNames == null ? void 0 : classNames.overlayAnimationIn) != null ? _classNames$overlayAn : classes.overlayAnimationIn : (_classNames$overlayAn2 = classNames == null ? void 0 : classNames.overlayAnimationOut) != null ? _classNames$overlayAn2 : classes.overlayAnimationOut;\n  var modalAnimation = open ? (_classNames$modalAnim = classNames == null ? void 0 : classNames.modalAnimationIn) != null ? _classNames$modalAnim : classes.modalAnimationIn : (_classNames$modalAnim2 = classNames == null ? void 0 : classNames.modalAnimationOut) != null ? _classNames$modalAnim2 : classes.modalAnimationOut;\n  return showPortal && containerModal ? ReactDom.createPortal(React.createElement(\"div\", {\n    className: cx(classes.root, classNames == null ? void 0 : classNames.root),\n    style: styles == null ? void 0 : styles.root,\n    \"data-testid\": \"root\"\n  }, React.createElement(\"div\", {\n    className: cx(classes.overlay, classNames == null ? void 0 : classNames.overlay),\n    \"data-testid\": \"overlay\",\n    \"aria-hidden\": true,\n    style: _extends({\n      animation: overlayAnimation + \" \" + animationDuration + \"ms\"\n    }, styles == null ? void 0 : styles.overlay)\n  }), React.createElement(\"div\", {\n    ref: refModal,\n    id: containerId,\n    className: cx(classes.modalContainer, center && classes.modalContainerCenter, classNames == null ? void 0 : classNames.modalContainer),\n    style: styles == null ? void 0 : styles.modalContainer,\n    \"data-testid\": \"modal-container\",\n    onClick: handleClickOverlay\n  }, React.createElement(\"div\", {\n    ref: refDialog,\n    className: cx(classes.modal, classNames == null ? void 0 : classNames.modal),\n    style: _extends({\n      animation: modalAnimation + \" \" + animationDuration + \"ms\"\n    }, styles == null ? void 0 : styles.modal),\n    onMouseDown: handleModalEvent,\n    onMouseUp: handleModalEvent,\n    onClick: handleModalEvent,\n    onAnimationEnd: handleAnimationEnd,\n    id: modalId,\n    role: role,\n    \"aria-modal\": \"true\",\n    \"aria-labelledby\": ariaLabelledby,\n    \"aria-describedby\": ariaDescribedby,\n    \"data-testid\": \"modal\",\n    tabIndex: -1\n  }, focusTrapped && React.createElement(FocusTrap, {\n    container: refDialog,\n    initialFocusRef: initialFocusRef\n  }), children, showCloseIcon && React.createElement(CloseIcon, {\n    classes: classes,\n    classNames: classNames,\n    styles: styles,\n    closeIcon: closeIcon,\n    onClick: onClose,\n    id: closeIconId\n  })))), containerModal) : null;\n});\nexport default Modal;\nexport { Modal };","map":{"version":3,"sources":["../src/CloseIcon.tsx","../src/utils.ts","../src/lib/focusTrapJs.ts","../src/FocusTrap.tsx","../src/modalManager.ts","../src/useScrollLock.ts","../src/index.tsx"],"names":["CloseIcon","classes","classNames","styles","id","closeIcon","onClick","className","cx","closeButton","style","width","height","viewBox","d","isBrowser","window","candidateSelectors","isHidden","node","offsetParent","getComputedStyle","visibility","getCheckedRadio","nodes","form","i","length","checked","isNotRadioOrTabbableRadio","tagName","type","name","radioScope","ownerDocument","radioSet","querySelectorAll","undefined","getAllTabbingElements","parentElem","currentActiveElement","document","activeElement","tabbableNodes","join","onlyTabbable","disabled","getTabindex","push","tabTrappingKey","event","key","contains","process","env","NODE_ENV","console","warn","target","allTabbingElements","firstFocusableElement","lastFocusableElement","shiftKey","focus","preventDefault","tabindexAttr","parseInt","getAttribute","isNaN","isContentEditable","tabIndex","FocusTrap","container","initialFocusRef","refLastFocus","useRef","useEffect","handleKeyEvent","current","addEventListener","savePreviousFocus","findIndex","selector","matches","requestAnimationFrame","removeEventListener","modals","modalManager","add","newModal","remove","oldModal","filter","modal","isTopModal","useModalManager","ref","open","useScrollLock","refModal","showPortal","blockScroll","reserveScrollBarGap","oldRef","disableBodyScroll","enableBodyScroll","root","overlay","overlayAnimationIn","overlayAnimationOut","modalContainer","modalContainerCenter","modalAnimationIn","modalAnimationOut","Modal","forwardRef","center","closeOnEsc","closeOnOverlayClick","showCloseIcon","closeIconId","focusTrapped","animationDuration","role","ariaDescribedby","ariaLabelledby","containerId","modalId","onClose","onEscKeyDown","onOverlayClick","onAnimationEnd","children","refDialog","useForwardedRef","refShouldClose","refContainer","createElement","setShowPortal","useState","handleOpen","body","appendChild","handleKeydown","handleClose","removeChild","keyCode","handleClickOverlay","handleModalEvent","handleAnimationEnd","containerModal","overlayAnimation","modalAnimation","createPortal","animation","onMouseDown","onMouseUp"],"mappings":"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","sourcesContent":["import React from 'react';\nimport cx from 'classnames';\n\ninterface CloseIconProps {\n  id?: string;\n  closeIcon?: React.ReactNode;\n  styles?: {\n    closeButton?: React.CSSProperties;\n    closeIcon?: React.CSSProperties;\n  };\n  classNames?: {\n    closeButton?: string;\n    closeIcon?: string;\n  };\n  classes: {\n    closeButton?: string;\n  };\n  onClick: () => void;\n}\n\nconst CloseIcon = ({\n  classes,\n  classNames,\n  styles,\n  id,\n  closeIcon,\n  onClick,\n}: CloseIconProps) => (\n  <button\n    id={id}\n    className={cx(classes.closeButton, classNames?.closeButton)}\n    style={styles?.closeButton}\n    onClick={onClick}\n    data-testid=\"close-button\"\n  >\n    {closeIcon ? (\n      closeIcon\n    ) : (\n      <svg\n        className={classNames?.closeIcon}\n        style={styles?.closeIcon}\n        width={28}\n        height={28}\n        viewBox=\"0 0 36 36\"\n        data-testid=\"close-icon\"\n      >\n        <path d=\"M28.5 9.62L26.38 7.5 18 15.88 9.62 7.5 7.5 9.62 15.88 18 7.5 26.38l2.12 2.12L18 20.12l8.38 8.38 2.12-2.12L20.12 18z\" />\n      </svg>\n    )}\n  </button>\n);\n\nexport default CloseIcon;\n","export const isBrowser = typeof window !== 'undefined';\n","// https://github.com/alexandrzavalii/focus-trap-js/blob/master/src/index.js v1.1.0\n\nexport const candidateSelectors = [\n  'input',\n  'select',\n  'textarea',\n  'a[href]',\n  'button',\n  '[tabindex]',\n  'audio[controls]',\n  'video[controls]',\n  '[contenteditable]:not([contenteditable=\"false\"])',\n];\n\nfunction isHidden(node: any) {\n  // offsetParent being null will allow detecting cases where an element is invisible or inside an invisible element,\n  // as long as the element does not use position: fixed. For them, their visibility has to be checked directly as well.\n  return (\n    node.offsetParent === null || getComputedStyle(node).visibility === 'hidden'\n  );\n}\n\nfunction getCheckedRadio(nodes: any, form: any) {\n  for (var i = 0; i < nodes.length; i++) {\n    if (nodes[i].checked && nodes[i].form === form) {\n      return nodes[i];\n    }\n  }\n}\n\nfunction isNotRadioOrTabbableRadio(node: any) {\n  if (node.tagName !== 'INPUT' || node.type !== 'radio' || !node.name) {\n    return true;\n  }\n  var radioScope = node.form || node.ownerDocument;\n  var radioSet = radioScope.querySelectorAll(\n    'input[type=\"radio\"][name=\"' + node.name + '\"]'\n  );\n  var checked = getCheckedRadio(radioSet, node.form);\n  return checked === node || (checked === undefined && radioSet[0] === node);\n}\n\nexport function getAllTabbingElements(parentElem: any) {\n  var currentActiveElement = document.activeElement;\n  var tabbableNodes = parentElem.querySelectorAll(candidateSelectors.join(','));\n  var onlyTabbable = [];\n  for (var i = 0; i < tabbableNodes.length; i++) {\n    var node = tabbableNodes[i];\n    if (\n      currentActiveElement === node ||\n      (!node.disabled &&\n        getTabindex(node) > -1 &&\n        !isHidden(node) &&\n        isNotRadioOrTabbableRadio(node))\n    ) {\n      onlyTabbable.push(node);\n    }\n  }\n  return onlyTabbable;\n}\n\nexport function tabTrappingKey(event: any, parentElem: any) {\n  // check if current event keyCode is tab\n  if (!event || event.key !== 'Tab') return;\n\n  if (!parentElem || !parentElem.contains) {\n    if (process && process.env.NODE_ENV === 'development') {\n      console.warn('focus-trap-js: parent element is not defined');\n    }\n    return false;\n  }\n\n  if (!parentElem.contains(event.target)) {\n    return false;\n  }\n\n  var allTabbingElements = getAllTabbingElements(parentElem);\n  var firstFocusableElement = allTabbingElements[0];\n  var lastFocusableElement = allTabbingElements[allTabbingElements.length - 1];\n\n  if (event.shiftKey && event.target === firstFocusableElement) {\n    lastFocusableElement.focus();\n    event.preventDefault();\n    return true;\n  } else if (!event.shiftKey && event.target === lastFocusableElement) {\n    firstFocusableElement.focus();\n    event.preventDefault();\n    return true;\n  }\n  return false;\n}\n\nfunction getTabindex(node: any) {\n  var tabindexAttr = parseInt(node.getAttribute('tabindex'), 10);\n\n  if (!isNaN(tabindexAttr)) return tabindexAttr;\n  // Browsers do not return tabIndex correctly for contentEditable nodes;\n  // so if they don't have a tabindex attribute specifically set, assume it's 0.\n\n  if (isContentEditable(node)) return 0;\n  return node.tabIndex;\n}\n\nfunction isContentEditable(node: any) {\n  return node.getAttribute('contentEditable');\n}\n","import { useEffect, useRef } from 'react';\nimport { isBrowser } from './utils';\nimport {\n  tabTrappingKey,\n  candidateSelectors,\n  getAllTabbingElements,\n} from './lib/focusTrapJs';\n\ninterface FocusTrapProps {\n  container?: React.RefObject<HTMLElement> | null;\n  initialFocusRef?: React.RefObject<HTMLElement>;\n}\n\nexport const FocusTrap = ({ container, initialFocusRef }: FocusTrapProps) => {\n  const refLastFocus = useRef<HTMLElement | null>();\n  /**\n   * Handle focus lock on the modal\n   */\n  useEffect(() => {\n    const handleKeyEvent = (event: KeyboardEvent) => {\n      if (container?.current) {\n        tabTrappingKey(event, container.current);\n      }\n    };\n\n    if (isBrowser) {\n      document.addEventListener('keydown', handleKeyEvent);\n    }\n    // On mount we focus on the first focusable element in the modal if there is one\n    if (isBrowser && container?.current) {\n      const savePreviousFocus = () => {\n        // First we save the last focused element\n        // only if it's a focusable element\n        if (\n          candidateSelectors.findIndex((selector) =>\n            document.activeElement?.matches(selector)\n          ) !== -1\n        ) {\n          refLastFocus.current = document.activeElement as HTMLElement;\n        }\n      };\n\n      if (initialFocusRef) {\n        savePreviousFocus();\n        // We need to schedule focusing on a next frame - this allows to focus on the modal root\n        requestAnimationFrame(() => {\n          initialFocusRef.current?.focus();\n        });\n      } else {\n        const allTabbingElements = getAllTabbingElements(container.current);\n        if (allTabbingElements[0]) {\n          savePreviousFocus();\n          allTabbingElements[0].focus();\n        }\n      }\n    }\n    return () => {\n      if (isBrowser) {\n        document.removeEventListener('keydown', handleKeyEvent);\n        // On unmount we restore the focus to the last focused element\n        refLastFocus.current?.focus();\n      }\n    };\n  }, [container, initialFocusRef]);\n\n  return null;\n};\n","import { Ref, useEffect } from 'react';\n\nlet modals: Ref<Element>[] = [];\n\n/**\n * Handle the order of the modals.\n * Inspired by the material-ui implementation.\n */\nexport const modalManager = {\n  /**\n   * Register a new modal\n   */\n  add: (newModal: Ref<Element>) => {\n    modals.push(newModal);\n  },\n\n  /**\n   * Remove a modal\n   */\n  remove: (oldModal: Ref<Element>) => {\n    modals = modals.filter((modal) => modal !== oldModal);\n  },\n\n  /**\n   * When multiple modals are rendered will return true if current modal is the last one\n   */\n  isTopModal: (modal: Ref<Element>) =>\n    !!modals.length && modals[modals.length - 1] === modal,\n};\n\nexport function useModalManager(ref: Ref<Element>, open: boolean) {\n  useEffect(() => {\n    if (open) {\n      modalManager.add(ref);\n    }\n    return () => {\n      modalManager.remove(ref);\n    };\n  }, [open, ref]);\n}\n","import { useEffect, useRef } from 'react';\nimport { disableBodyScroll, enableBodyScroll } from 'body-scroll-lock';\n\nexport const useScrollLock = (\n  refModal: React.RefObject<Element>,\n  open: boolean,\n  showPortal: boolean,\n  blockScroll: boolean,\n  reserveScrollBarGap?: boolean\n) => {\n  const oldRef = useRef<Element | null>(null);\n\n  useEffect(() => {\n    if (open && refModal.current && blockScroll) {\n      oldRef.current = refModal.current;\n      disableBodyScroll(refModal.current, { reserveScrollBarGap });\n    }\n    return () => {\n      if (oldRef.current) {\n        enableBodyScroll(oldRef.current);\n        oldRef.current = null;\n      }\n    };\n  }, [open, showPortal, refModal, blockScroll, reserveScrollBarGap]);\n};\n","import React, { useEffect, useRef, useState } from 'react';\nimport ReactDom from 'react-dom';\nimport cx from 'classnames';\nimport CloseIcon from './CloseIcon';\nimport { FocusTrap } from './FocusTrap';\nimport { modalManager, useModalManager } from './modalManager';\nimport { useScrollLock } from './useScrollLock';\nimport { isBrowser } from './utils';\nimport useForwardedRef from '@bedrock-layout/use-forwarded-ref';\n\nconst classes = {\n  root: 'react-responsive-modal-root',\n  overlay: 'react-responsive-modal-overlay',\n  overlayAnimationIn: 'react-responsive-modal-overlay-in',\n  overlayAnimationOut: 'react-responsive-modal-overlay-out',\n  modalContainer: 'react-responsive-modal-container',\n  modalContainerCenter: 'react-responsive-modal-containerCenter',\n  modal: 'react-responsive-modal-modal',\n  modalAnimationIn: 'react-responsive-modal-modal-in',\n  modalAnimationOut: 'react-responsive-modal-modal-out',\n  closeButton: 'react-responsive-modal-closeButton',\n};\n\nexport interface ModalProps {\n  /**\n   * Control if the modal is open or not.\n   */\n  open: boolean;\n  /**\n   * Should the dialog be centered.\n   *\n   * Default to false.\n   */\n  center?: boolean;\n  /**\n   * Is the modal closable when user press esc key.\n   *\n   * Default to true.\n   */\n  closeOnEsc?: boolean;\n  /**\n   * Is the modal closable when user click on overlay.\n   *\n   * Default to true.\n   */\n  closeOnOverlayClick?: boolean;\n  /**\n   * Whether to block scrolling when dialog is open.\n   *\n   * Default to true.\n   */\n  blockScroll?: boolean;\n  /**\n   * Show the close icon.\n   *\n   * Default to true.\n   */\n  showCloseIcon?: boolean;\n  /**\n   * id attribute for the close icon button.\n   */\n  closeIconId?: string;\n  /**\n   * Custom icon to render (svg, img, etc...).\n   */\n  closeIcon?: React.ReactNode;\n  /**\n   * When the modal is open, trap focus within it.\n   *\n   * Default to true.\n   */\n  focusTrapped?: boolean;\n  /**\n   * Element to focus when focus trap is used.\n   *\n   * Default to undefined.\n   */\n  initialFocusRef?: React.RefObject<HTMLElement>;\n  /**\n   * You can specify a container prop which should be of type `Element`.\n   * The portal will be rendered inside that element.\n   * The default behavior will create a div node and render it at the at the end of document.body.\n   */\n  container?: Element | null;\n  /**\n   * An object containing classNames to style the modal.\n   */\n  classNames?: {\n    root?: string;\n    overlay?: string;\n    overlayAnimationIn?: string;\n    overlayAnimationOut?: string;\n    modalContainer?: string;\n    modal?: string;\n    modalAnimationIn?: string;\n    modalAnimationOut?: string;\n    closeButton?: string;\n    closeIcon?: string;\n  };\n  /**\n   * An object containing the styles objects to style the modal.\n   */\n  styles?: {\n    root?: React.CSSProperties;\n    overlay?: React.CSSProperties;\n    modalContainer?: React.CSSProperties;\n    modal?: React.CSSProperties;\n    closeButton?: React.CSSProperties;\n    closeIcon?: React.CSSProperties;\n  };\n  /**\n   * Animation duration in milliseconds.\n   *\n   * Default to 300.\n   */\n  animationDuration?: number;\n  /**\n   * ARIA role for modal\n   *\n   * Default to 'dialog'.\n   */\n  role?: string;\n  /**\n   * ARIA label for modal\n   */\n  ariaLabelledby?: string;\n  /**\n   * ARIA description for modal\n   */\n  ariaDescribedby?: string;\n  /**\n   * Avoid unpleasant flickering effect when body overflow is hidden. For more information see https://www.npmjs.com/package/body-scroll-lock\n   */\n  reserveScrollBarGap?: boolean;\n  /**\n   * id attribute for modal container\n   */\n  containerId?: string;\n  /**\n   * id attribute for modal\n   */\n  modalId?: string;\n  /**\n   * Callback fired when the Modal is requested to be closed by a click on the overlay or when user press esc key.\n   */\n  onClose: () => void;\n  /**\n   * Callback fired when the escape key is pressed.\n   */\n  onEscKeyDown?: (event: KeyboardEvent) => void;\n  /**\n   * Callback fired when the overlay is clicked.\n   */\n  onOverlayClick?: (\n    event: React.MouseEvent<HTMLDivElement, MouseEvent>\n  ) => void;\n  /**\n   * Callback fired when the Modal has exited and the animation is finished.\n   */\n  onAnimationEnd?: () => void;\n  children?: React.ReactNode;\n}\n\nexport const Modal = React.forwardRef(\n  (\n    {\n      open,\n      center,\n      blockScroll = true,\n      closeOnEsc = true,\n      closeOnOverlayClick = true,\n      container,\n      showCloseIcon = true,\n      closeIconId,\n      closeIcon,\n      focusTrapped = true,\n      initialFocusRef = undefined,\n      animationDuration = 300,\n      classNames,\n      styles,\n      role = 'dialog',\n      ariaDescribedby,\n      ariaLabelledby,\n      containerId,\n      modalId,\n      onClose,\n      onEscKeyDown,\n      onOverlayClick,\n      onAnimationEnd,\n      children,\n      reserveScrollBarGap,\n    }: ModalProps,\n    ref: React.ForwardedRef<HTMLDivElement>\n  ) => {\n    const refDialog = useForwardedRef(ref);\n    const refModal = useRef<HTMLDivElement>(null);\n    const refShouldClose = useRef<boolean | null>(null);\n    const refContainer = useRef<HTMLDivElement | null>(null);\n    // Lazily create the ref instance\n    // https://reactjs.org/docs/hooks-faq.html#how-to-create-expensive-objects-lazily\n    if (refContainer.current === null && isBrowser) {\n      refContainer.current = document.createElement('div');\n    }\n\n    // The value should be false for srr, that way when the component is hydrated client side,\n    // it will match the server rendered content\n    const [showPortal, setShowPortal] = useState(false);\n\n    // Hook used to manage multiple modals opened at the same time\n    useModalManager(refModal, open);\n\n    // Hook used to manage the scroll\n    useScrollLock(refModal, open, showPortal, blockScroll, reserveScrollBarGap);\n\n    const handleOpen = () => {\n      if (\n        refContainer.current &&\n        !container &&\n        !document.body.contains(refContainer.current)\n      ) {\n        document.body.appendChild(refContainer.current);\n      }\n\n      document.addEventListener('keydown', handleKeydown);\n    };\n\n    const handleClose = () => {\n      if (\n        refContainer.current &&\n        !container &&\n        document.body.contains(refContainer.current)\n      ) {\n        document.body.removeChild(refContainer.current);\n      }\n      document.removeEventListener('keydown', handleKeydown);\n    };\n\n    const handleKeydown = (event: KeyboardEvent) => {\n      // Only the last modal need to be escaped when pressing the esc key\n      if (event.keyCode !== 27 || !modalManager.isTopModal(refModal)) {\n        return;\n      }\n\n      onEscKeyDown?.(event);\n\n      if (closeOnEsc) {\n        onClose();\n      }\n    };\n\n    useEffect(() => {\n      return () => {\n        if (showPortal) {\n          // When the modal is closed or removed directly, cleanup the listeners\n          handleClose();\n        }\n      };\n    }, [showPortal]);\n\n    useEffect(() => {\n      // If the open prop is changing, we need to open the modal\n      // This is also called on the first render if the open prop is true when the modal is created\n      if (open && !showPortal) {\n        setShowPortal(true);\n        handleOpen();\n      }\n    }, [open]);\n\n    const handleClickOverlay = (\n      event: React.MouseEvent<HTMLDivElement, MouseEvent>\n    ) => {\n      if (refShouldClose.current === null) {\n        refShouldClose.current = true;\n      }\n\n      if (!refShouldClose.current) {\n        refShouldClose.current = null;\n        return;\n      }\n\n      onOverlayClick?.(event);\n\n      if (closeOnOverlayClick) {\n        onClose();\n      }\n\n      refShouldClose.current = null;\n    };\n\n    const handleModalEvent = () => {\n      refShouldClose.current = false;\n    };\n\n    const handleAnimationEnd = () => {\n      if (!open) {\n        setShowPortal(false);\n      }\n\n      onAnimationEnd?.();\n    };\n\n    const containerModal = container || refContainer.current;\n\n    const overlayAnimation = open\n      ? classNames?.overlayAnimationIn ?? classes.overlayAnimationIn\n      : classNames?.overlayAnimationOut ?? classes.overlayAnimationOut;\n\n    const modalAnimation = open\n      ? classNames?.modalAnimationIn ?? classes.modalAnimationIn\n      : classNames?.modalAnimationOut ?? classes.modalAnimationOut;\n\n    return showPortal && containerModal\n      ? ReactDom.createPortal(\n          <div\n            className={cx(classes.root, classNames?.root)}\n            style={styles?.root}\n            data-testid=\"root\"\n          >\n            <div\n              className={cx(classes.overlay, classNames?.overlay)}\n              data-testid=\"overlay\"\n              aria-hidden={true}\n              style={{\n                animation: `${overlayAnimation} ${animationDuration}ms`,\n                ...styles?.overlay,\n              }}\n            />\n            <div\n              ref={refModal}\n              id={containerId}\n              className={cx(\n                classes.modalContainer,\n                center && classes.modalContainerCenter,\n                classNames?.modalContainer\n              )}\n              style={styles?.modalContainer}\n              data-testid=\"modal-container\"\n              onClick={handleClickOverlay}\n            >\n              <div\n                ref={refDialog}\n                className={cx(classes.modal, classNames?.modal)}\n                style={{\n                  animation: `${modalAnimation} ${animationDuration}ms`,\n                  ...styles?.modal,\n                }}\n                onMouseDown={handleModalEvent}\n                onMouseUp={handleModalEvent}\n                onClick={handleModalEvent}\n                onAnimationEnd={handleAnimationEnd}\n                id={modalId}\n                role={role}\n                aria-modal=\"true\"\n                aria-labelledby={ariaLabelledby}\n                aria-describedby={ariaDescribedby}\n                data-testid=\"modal\"\n                tabIndex={-1}\n              >\n                {focusTrapped && (\n                  <FocusTrap\n                    container={refDialog}\n                    initialFocusRef={initialFocusRef}\n                  />\n                )}\n                {children}\n                {showCloseIcon && (\n                  <CloseIcon\n                    classes={classes}\n                    classNames={classNames}\n                    styles={styles}\n                    closeIcon={closeIcon}\n                    onClick={onClose}\n                    id={closeIconId}\n                  />\n                )}\n              </div>\n            </div>\n          </div>,\n          containerModal\n        )\n      : null;\n  }\n);\n\nexport default Modal;\n"]},"metadata":{},"sourceType":"module"}